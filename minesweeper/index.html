<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minesweeper</title>
  <style>
    :root {
      --cell-size: 32px;
      --font-family: 'Courier New', monospace;
      --mine-color: red;
      --flag-color: blue;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: var(--font-family);
      background: #f1f3f6;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      margin: 10px;
    }
    .controls {
      margin: 10px;
      display: flex;
      gap: 8px;
    }
    .info {
      display: flex;
      justify-content: space-between;
      width: 300px;
      margin-bottom: 8px;
      font-size: 18px;
    }
    .board {
      display: grid;
      grid-gap: 2px;
      background: #666;
      padding: 4px;
    }
    .cell {
      width: var(--cell-size);
      height: var(--cell-size);
      background: linear-gradient(145deg, #e2e8f0, #ffffff);
      border: 2px solid #cbd5e0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 16px;
      user-select: none;
      cursor: pointer;
    }
    .cell.revealed {
      background: #e5e7eb;
      border: 2px inset #cbd5e0;
      cursor: default;
    }
    .cell.flagged {
      color: var(--flag-color);
    }
    .cell.mine {
      color: var(--mine-color);
    }
    select, input, button {
      padding: 4px;
    }
  </style>
</head>
<body>
  <h1>Minesweeper</h1>
  <div class="controls">
    <label>Mode:
      <select id="preset">
        <option value="9,9,10">Beginner (9x9, 10 mines)</option>
        <option value="16,16,40">Intermediate (16x16, 40 mines)</option>
        <option value="30,16,99">Expert (30x16, 99 mines)</option>
        <option value="custom">Custom</option>
      </select>
    </label>
    <label>W: <input type="number" id="w" value="9" min="5"></label>
    <label>H: <input type="number" id="h" value="9" min="5"></label>
    <label>M: <input type="number" id="m" value="10" min="1"></label>
    <button id="start">Start</button>
  </div>
  <div class="info">
    <div>Mines left: <span id="minesLeft"></span></div>
    <div>Time: <span id="timer">0</span>s</div>
  </div>
  <div class="board" id="board"></div>

  <script>
    const boardEl = document.getElementById('board');
    const minesLeftEl = document.getElementById('minesLeft');
    const timerEl = document.getElementById('timer');
    const presetEl = document.getElementById('preset');
    const wEl = document.getElementById('w');
    const hEl = document.getElementById('h');
    const mEl = document.getElementById('m');
    const startBtn = document.getElementById('start');

    let board = [];
    let width, height, mineCount;
    let timer = 0;
    let timerInterval;
    let gameOver = false;
    let cellsRevealed = 0;
    let totalCells = 0;

    presetEl.addEventListener('change', () => {
      const val = presetEl.value;
      if (val !== 'custom') {
        const [w, h, m] = val.split(',');
        wEl.value = w;
        hEl.value = h;
        mEl.value = m;
      }
    });

    startBtn.addEventListener('click', startGame);

    function startGame() {
      clearInterval(timerInterval);
      timer = 0;
      timerEl.textContent = '0';
      boardEl.innerHTML = '';
      gameOver = false;

      width = parseInt(wEl.value);
      height = parseInt(hEl.value);
      mineCount = parseInt(mEl.value);
      totalCells = width * height;
      cellsRevealed = 0;

      board = Array.from({ length: height }, () => Array.from({ length: width }, () => ({ revealed: false, mine: false, flag: false, count: 0 })));

      // Place mines
      let placed = 0;
      while (placed < mineCount) {
        let x = Math.floor(Math.random() * width);
        let y = Math.floor(Math.random() * height);
        if (!board[y][x].mine) {
          board[y][x].mine = true;
          placed++;
        }
      }

      // Count neighbors
      for (let y = 0; y < height; y++) {
        for (let x = 0; x < width; x++) {
          if (!board[y][x].mine) {
            let count = 0;
            for (let dy = -1; dy <= 1; dy++) {
              for (let dx = -1; dx <= 1; dx++) {
                if (board[y+dy]?.[x+dx]?.mine) count++;
              }
            }
            board[y][x].count = count;
          }
        }
      }

      boardEl.style.gridTemplateColumns = `repeat(${width}, var(--cell-size))`;

      for (let y = 0; y < height; y++) {
        for (let x = 0; x < width; x++) {
          const cellEl = document.createElement('div');
          cellEl.className = 'cell';
          cellEl.dataset.x = x;
          cellEl.dataset.y = y;
          boardEl.appendChild(cellEl);
        }
      }

      minesLeftEl.textContent = mineCount;
      timerInterval = setInterval(() => timerEl.textContent = ++timer, 1000);
    }

    function reveal(x, y) {
      const cell = board[y][x];
      const el = getCellEl(x, y);
      if (cell.revealed || cell.flag) return;
      cell.revealed = true;
      cellsRevealed++;
      el.classList.add('revealed');
      el.textContent = cell.count || '';
      if (cell.count === 0) {
        for (let dy = -1; dy <= 1; dy++) {
          for (let dx = -1; dx <= 1; dx++) {
            if (dx !== 0 || dy !== 0) {
              if (board[y+dy]?.[x+dx]) reveal(x+dx, y+dy);
            }
          }
        }
      }
    }

    function getCellEl(x, y) {
      return boardEl.querySelector(`.cell[data-x='${x}'][data-y='${y}']`);
    }

    boardEl.addEventListener('contextmenu', e => e.preventDefault());

    boardEl.addEventListener('mousedown', e => {
      if (gameOver) return;
      const target = e.target.closest('.cell');
      if (!target) return;
      const x = +target.dataset.x;
      const y = +target.dataset.y;
      const cell = board[y][x];

      if (e.button === 2) {
        if (!cell.revealed) {
          cell.flag = !cell.flag;
          target.textContent = cell.flag ? 'ðŸš©' : '';
          minesLeftEl.textContent = mineCount - board.flat().filter(c => c.flag).length;
        }
      } else if (e.button === 0) {
        if (cell.mine) {
          target.textContent = 'ðŸ’£';
          target.classList.add('mine');
          gameOver = true;
          clearInterval(timerInterval);
          alert('Game Over!');
        } else {
          reveal(x, y);
          if (cellsRevealed === totalCells - mineCount) {
            gameOver = true;
            clearInterval(timerInterval);
            alert(`You win! Time: ${timer}s`);
          }
        }
      }
    });
  </script>
</body>
</html>
